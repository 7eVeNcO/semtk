<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<html>
<head>
<center>
<h2>Simple query server interface</h2>
Paul Cuddihy, Ravi Palla, Justin McHugh
<br>
Demonstration of queryserverinterface.js Javascript
<p>
	<!-- include the JavaScript -->
	<script type="text/javascript" src="../js/queryserverinterface.js"></script>
	
	<!-- simple style so the table doesn't look like a high school project (but it still does!) -->
	<style type="text/css">
	.tg  {border-collapse:collapse;border-spacing:0;border-color:#999;}
	.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#999;color:#444;background-color:#DFF4FF;border-top-width:1px;border-bottom-width:1px;}
	.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:bold;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#999;color:#black;background-color:#9CDEFF;border-top-width:1px;border-bottom-width:1px;}
	.tg .tg-e3zv{font-weight:bold}
	.tgembed {width:100%;}
	</style>

</head>
<body>

	<script type="text/javascript">
		
		// The form action 
		doQuery = function() {
			document.getElementById("results").innerHTML = "";
			
			
			// STEP 1: create an interface  
			var serverURL = document.getElementById("qsURL").value;
			var ksURL =     document.getElementById("ksURL").value;
			var source =    document.getElementById("Source").value;
			var sadl = new QueryServerInterface(serverURL, ksURL, source);
			
			// STEP 2: execute the query
			var query = document.getElementById("queryText").value;
			if (query.length < 1) {
				alert("Can't run empty query");
				
			} else {
				// HTML: tell user query is running
				document.getElementById("status").innerHTML= "<font color='red'>Status: running query...</font>";
				 
				sadl.executeAndParse(query, afterQuery);
			}
		};
		
		// The Callback  
		afterQuery = function(qsresult) {
		
			// HTML: tell user query is done
			document.getElementById("status").innerHTML= "Status: ready.";
			
			if (qsresult.isSuccess()) {
				
				// QueryServerResult will turn itsself into an HTML table on command
				var nsFlag = document.getElementById("namespace").checked? QueryServerResult.prototype.NAMESPACE_YES: QueryServerResult.prototype.NAMESPACE_NO;
				var resultTableHTML = qsresult.getResultsHTMLTable("class='tg'", nsFlag);
				document.getElementById("results").innerHTML= resultTableHTML;
			}
			else {
				alert(qsresult.getStatusMessage());
			}
		};
		
	</script>
	
	<form action="javascript:doQuery()">
	<table class='tg'><tr><th>
		 Enter query:
		 <br>
		 <TEXTAREA NAME="Query" id="queryText" ROWS=15 COLS=100>
PREFIX setup: <http://caterham.ge.com/setup#>
PREFIX car:<http://caterham.ge.com/car#>
PREFIX event:<http://caterham.ge.com/event#>

PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT distinct ?SessionName ?TeamName ?LapNum ?LapTime where {
?season event:hasEvent ?race. 
?season event:hasSeasonId ?SeasonId FILTER (?SeasonId = 2013).
?race rdf:type event:F1Race.
?race event:hasCircuit ?circuit.
?circuit event:hasCountry ?Country FILTER regex(?Country, "Bahrain").
?race event:hasSession ?session.
?session event:hasCompetitor ?competitor.
?competitor event:hasRun ?run.
?run event:hasLap ?lap.
?session event:hasSessionDisplayName ?SessionName.
?competitor event:hasTeamName ?TeamName.
?lap event:hasLapNumber ?LapNum.
?lap event:hasLapTime ?LapTime.
}
limit 10
		<!--   Note that a more clever programmer would populate these some smarter way -->
		</TEXTAREA>
		</th></tr>
		<td><table class='tgembed'>
		<tr><td><select id="qsURL">
			  <option value="http://etna3.crd.ge.com:8080/queryserver" selected>etna3</option>
			  <option value="http://kaas.research.ge.com:8080/queryserver/">kaas</option>
		</select></td>
		<td><select id="ksURL">
			  <option value="http://etna3.crd.ge.com:8080/sadlserver/SadlService" selected>etna3</option>
			  <option value="http://kaas-dev.research.ge.com:8080/sadlserver/SadlService">kaas-dev</option>
		</select></td>
		<td><select id="Source">
			  <option value="MRI">MRI Data</option>
			  <option value="TCGA">TCGA Data from ...</option>
			  <option value="ExtendedTCGA">Extended TCGA Data</option>
			  <option value="Integrated">Integrated Multi-Modal Data</option>
			  <option value="Radlex">Radlex Ontology</option>
			  <option value="Caterham" selected>Caterham Ontology</option>
		</select></td>
		
		<td><INPUT type="checkbox" id="namespace" checked> Show namespaces<br>
		<td><INPUT type="SUBMIT" VALUE="Run" size ="940"> </td></tr>
		</table></table>
		
    </form>
    <p id="status">Status: ready</p>
    <p id="results"></p>
 </body>
 </html>