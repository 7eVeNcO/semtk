<html>
  <head>
    
    <script>

    	//========= callbacks =========
		var api = null;
		
    	var errorCallback = function(msg) {
    		alert("GUI errorCallback: " + msg + "\n\nMore on the console.");
    		throw msg;
    	}
    	
    	// GUI developer writes this
    	var statusCallback = function(str) {
    		console.log(str);
    	};
    	
    	// GUI developer writes this
    	var failureCallback = function(html) {
    		alert("GUI failureCallback: " + html);
    	};
    	
    	// tell UI we're done loading stuff
    	var doneLoading = function() {
    		configureServices();
    		
    		document.getElementById("btnTest1").disabled=false;
    		document.getElementById("btnTest2").disabled=false;
    	};
    	
    	var configureServices = function() {
			semtk.setSparqlQueryService("http://vesuvius37.crd.ge.com:12050/sparqlQueryService", failureCallback, 45000);
			semtk.setOntologyService(   "http://vesuvius37.crd.ge.com:12057/ontologyinfo",       failureCallback, 45000);
    	};
    	
    	var test1 = function() {
    		semtk.clearNodegroup();
    		connectViaServiceAsync(testBuildSparql);
    	};
    	
    	var test2 = function() {
    		alert("test2 is empty");
    	};
		
		var connectViaServiceAsync = function(callback) {
			var name = "maples-conn";
			var type = "virtuoso";
			var domain = "http://";
			semtk.setupSparqlConnection(name, type, domain);
			
			semtk.setSparqlModelConnection("http://vesuvius37.crd.ge.com:2420", "http://kdl.ge.com/GE/blueprintV5");
			semtk.setSparqlDataConnection ("http://vesuvius37.crd.ge.com:2420", "http://kdl.ge.com/GE/blueprintV5");
			semtk.loadModelAsync(statusCallback, callback, failureCallback)
		}
		
		var alertClasses = function() {
			alert("oInfo classes: " + semtk.getClassNames());
		}
		
		var testBuildSparql = function() {
			// get classes
			var classList = semtk.getClassNames();
			if (classList.length == 0) {
				throw "testBuildSparql: classList.length is 0";
			}
			
			// deciding on a  class and property
			var classURI = "http://kdl.ge.com/GE/blueprintv5#Equipment";
			var propURI = "http://kdl.ge.com/GE/blueprintv5#equipmentName";
			
			if (! semtk.modelContainsClass(classURI)) {
				throw "testBuildSparql: model doesn't contain class: " + classURI;
			}
			if (! semtk.classContainsProperty(classURI, propURI)) {
				throw "testBuildSparql: " + classURI + " doesn't contain prop: " + propURI;
			}
			
			// add a node with this class
			var sparqlID = semtk.addClassFirstPath(classURI);
			if (! sparqlID) {
				throw "testBuildSparql: failed to add URI to nodegroup: " + classURI;
			}
			
			// delete and re-add
			semtk.deleteNode(sparqlID);
			sparqlID = semtk.addClassFirstPath(classURI);
			
			// set property to return
			semtk.setPropertyReturned(sparqlID, propURI, true);
			
			// set values constraint
			semtk.setPropertyValueConstraint(sparqlID, propURI, ["belmont/generateSparqlInsert#7EA_98671", 
			                                                     "belmont/generateSparqlInsert#7FA_42087", 
			                                                     "belmont/generateSparqlInsert#BP_CC_BFP_S"]);
			var sparql = semtk.getSparqlSelect(100);
			alert("SPARQL: \n" + sparql);
			
			semtk.getModelDrawJSONAsync(testBuildSparql2);
		};
		
		var testBuildSparql2 = function(json) {
			alert("Model:\n" + JSON.stringify(json));
			
			alert("Nodegroup:\n" + JSON.stringify(semtk.getNodegroupDrawJSON()));
		};
	</script>
	
	<script>	
		SEMTK_ERROR_CALLBACK = errorCallback; // error function (messageString)
		SEMTK_LOAD_CALLBACK = doneLoading;   // ready function.  Uses the global: semtk
		SEMTK_LOAD_PATH = "..";              // relative URL path to folder containing iidx-oss and sparqlGraph
    </script>

	<script src="../sparqlGraph/js/semtk_api_loader.js"></script>
	
  </head>

  <body>
    Demo of Semtk API
    <p>
    <button id="btnTest1" disabled=true onclick="test1();">Gen Sparql</button>
    <button id="btnTest2" disabled=true onclick="test2();">test2</button>
    
    
  </body>
</html>
